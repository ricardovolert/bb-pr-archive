{
    "reason": "",
    "state": "MERGED",
    "updated_on": "2015-11-09T19:10:21.284947+00:00",
    "comment_count": 6,
    "description": "This rewrites the selector hash function.\r\n\r\nThere are two major changes:\r\n\r\n1. We no longer rely on the python hash function, instead we convert the data we want to hash into bytes. I'm doing slightly silly stuff (converting floats to strings and then strings to ascii-encoded bytes), so any suggestions to make this nicer would be much appreciated. The upshot is that this no longer relies on python3's randomized hash seed.\r\n\r\n2. Instead of passing integers to the FNV algorithm, which was incorrect, we now do the hash on a byte-by-byte basis, which is what the website describing FNV suggests.\r\n\r\nWith this pull request and my two other open py3 pull requests, the unit tests now pass under python3.",
    "created_on": "2015-11-03T21:05:45.321707+00:00",
    "task_count": 0,
    "merge_commit": null,
    "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
    "links": {
        "diff": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/diff"
        },
        "decline": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/decline"
        },
        "self": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
        },
        "activity": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/activity"
        },
        "merge": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/merge"
        },
        "commits": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/commits"
        },
        "statuses": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/statuses"
        },
        "approve": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/approve"
        },
        "html": {
            "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
        },
        "comments": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments"
        }
    },
    "closed_by": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/jzuhone"
            },
            "html": {
                "href": "https://bitbucket.org/jzuhone/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/jzuhone/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "John ZuHone",
        "uuid": "{0c51edfa-e317-432f-bbef-7401c6e2aa8a}",
        "username": "jzuhone"
    },
    "id": 1845,
    "type": "pullrequest",
    "author": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
            },
            "html": {
                "href": "https://bitbucket.org/ngoldbaum/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Nathan Goldbaum",
        "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
        "username": "ngoldbaum"
    },
    "source": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/ngoldbaum/yt/commit/1e45b8fbc35c"
                }
            },
            "hash": "1e45b8fbc35c"
        },
        "repository": {
            "full_name": "ngoldbaum/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/ngoldbaum/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/ngoldbaum/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/ngoldbaum/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{cb18d7d9-ab77-4e80-81ed-8d32a945e0ef}"
        }
    },
    "close_source_branch": false,
    "destination": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/f264885c3fb4"
                }
            },
            "hash": "f264885c3fb4"
        },
        "repository": {
            "full_name": "yt_analysis/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/yt_analysis/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b73cb37c-40f2-493a-aaa9-41bc8d8974cc}"
        }
    },
    "comments": [
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11440113"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11440113"
                }
            },
            "pullrequest": {
                "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
                    }
                },
                "id": 1845
            },
            "content": {
                "raw": "All tests pass. Good job!",
                "html": "<p>All tests pass. Good job!</p>",
                "markup": "markdown"
            },
            "created_on": "2015-11-03T22:21:46.976723+00:00",
            "updated_on": "2015-11-03T22:21:47.143869+00:00",
            "id": 11440113
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
                    },
                    "html": {
                        "href": "https://bitbucket.org/ngoldbaum/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Nathan Goldbaum",
                "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
                "username": "ngoldbaum"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11473390"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11473390"
                }
            },
            "pullrequest": {
                "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
                    }
                },
                "id": 1845
            },
            "content": {
                "raw": "@xarthisius any chance I can get you to take a look at this?",
                "html": "<p><a href=\"/xarthisius/\" rel=\"nofollow\" title=\"@xarthisius\" class=\"mention\">Kacper Kowalik</a> any chance I can get you to take a look at this?</p>",
                "markup": "markdown"
            },
            "created_on": "2015-11-04T16:51:02.223803+00:00",
            "updated_on": "2015-11-04T16:51:02.232193+00:00",
            "id": 11473390
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/xarthisius"
                    },
                    "html": {
                        "href": "https://bitbucket.org/xarthisius/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/xarthisius/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Kacper Kowalik",
                "uuid": "{26af8f1d-35b3-46ce-9939-09915b06e31f}",
                "username": "xarthisius"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11474995"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11474995"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11473390"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11473390"
                    }
                },
                "id": 11473390
            },
            "pullrequest": {
                "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
                    }
                },
                "id": 1845
            },
            "content": {
                "raw": "If it fixes the failures it's good :-)",
                "html": "<p>If it fixes the failures it's good :-)</p>",
                "markup": "markdown"
            },
            "created_on": "2015-11-04T17:25:34.587911+00:00",
            "updated_on": "2015-11-04T17:25:34.592648+00:00",
            "id": 11474995
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
                    },
                    "html": {
                        "href": "https://bitbucket.org/ngoldbaum/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Nathan Goldbaum",
                "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
                "username": "ngoldbaum"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11475069"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11475069"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11474995"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11474995"
                    }
                },
                "id": 11474995
            },
            "pullrequest": {
                "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
                    }
                },
                "id": 1845
            },
            "content": {
                "raw": "Well, specifically the concerns I had about converting the hash values to bytes. Is there a better way than \n\n```\nif isinstance(v, tuple):\n    hash_data.extend(v[0].encode('ascii'))\n    hash_data.extend(str(v[1]).encode('ascii'))\nelse:\n    hash_data.extend(str(v).encode('ascii'))\n```\n\nThis converts the float `5.6456` into the string `'5.6456'` which is then serialized to bytes.  Just as an example, there are other possible types we need to hash as well.",
                "html": "<p>Well, specifically the concerns I had about converting the hash values to bytes. Is there a better way than </p>\n<div class=\"codehilite\"><pre><span></span>if isinstance(v, tuple):\n    hash_data.extend(v[0].encode(&#39;ascii&#39;))\n    hash_data.extend(str(v[1]).encode(&#39;ascii&#39;))\nelse:\n    hash_data.extend(str(v).encode(&#39;ascii&#39;))\n</pre></div>\n\n\n<p>This converts the float <code>5.6456</code> into the string <code>'5.6456'</code> which is then serialized to bytes.  Just as an example, there are other possible types we need to hash as well.</p>",
                "markup": "markdown"
            },
            "created_on": "2015-11-04T17:27:26.724619+00:00",
            "updated_on": "2015-11-04T17:27:26.727735+00:00",
            "id": 11475069
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
                    },
                    "html": {
                        "href": "https://bitbucket.org/ngoldbaum/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Nathan Goldbaum",
                "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
                "username": "ngoldbaum"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11589626"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11589626"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11475069"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11475069"
                    }
                },
                "id": 11475069
            },
            "pullrequest": {
                "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
                    }
                },
                "id": 1845
            },
            "content": {
                "raw": "It turns out `repr` is guaranteed to produce something that can be recreated exactly for most builtin types.",
                "html": "<p>It turns out <code>repr</code> is guaranteed to produce something that can be recreated exactly for most builtin types.</p>",
                "markup": "markdown"
            },
            "created_on": "2015-11-09T05:36:24.388343+00:00",
            "updated_on": "2015-11-09T05:36:24.390250+00:00",
            "id": 11589626
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845/comments/11591496"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845/_/diff#comment-11591496"
                }
            },
            "pullrequest": {
                "title": "Pass bytes to FNV hashing algorithm, don't rely on python hashes",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1845"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1845"
                    }
                },
                "id": 1845
            },
            "content": {
                "raw": "All tests pass. Good job!",
                "html": "<p>All tests pass. Good job!</p>",
                "markup": "markdown"
            },
            "created_on": "2015-11-09T07:28:21.784093+00:00",
            "updated_on": "2015-11-09T07:28:21.833410+00:00",
            "id": 11591496
        }
    ]
}