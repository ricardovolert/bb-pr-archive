{
    "reason": "I believe this is a valid approach, *except* that it requires a copy-on-write for field attributes, which is presently out of scope.",
    "state": "DECLINED",
    "updated_on": "2016-12-15T18:45:36.033804+00:00",
    "comment_count": 6,
    "description": "This adds an experimental method of caching the computation of derived fields in a dataset.  Right now it *always* caches, which is expensive.  Eventually, if this begins to pass the tests, we will instead only cache the \"N most recent\" sets of fields.\r\n\r\nFor a demonstrate of what this does, this script sees about a 3.5x speedup using this machinery:\r\n\r\n```\r\n#!python\r\nimport time\r\nimport yt\r\nt1 = time.time()\r\nss = yt.load(\"gadget_halos/data/groups_*/fof_subhalo_tab_*.0.hdf5\")\r\nfor ds in ss[200:]:\r\n    print ds, ds.r[\"Group\", \"GroupMass\"].max().in_units(\"Msun\")\r\nt2 = time.time()\r\nprint \"Time took: %0.3e\" % (t2-t1)\r\n```\r\n\r\nThere are likely problems or some things I have missed, but I'm submitting as a PR as a proof of concept.",
    "created_on": "2016-03-21T19:20:41.751454+00:00",
    "task_count": 0,
    "merge_commit": null,
    "title": "Experimental derived field caching",
    "links": {
        "diff": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/diff"
        },
        "decline": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/decline"
        },
        "self": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059"
        },
        "activity": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/activity"
        },
        "merge": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/merge"
        },
        "commits": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/commits"
        },
        "statuses": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/statuses"
        },
        "approve": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/approve"
        },
        "html": {
            "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059"
        },
        "comments": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/comments"
        }
    },
    "closed_by": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
            },
            "html": {
                "href": "https://bitbucket.org/MatthewTurk/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Matt Turk",
        "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
        "username": "MatthewTurk"
    },
    "id": 2059,
    "type": "pullrequest",
    "author": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
            },
            "html": {
                "href": "https://bitbucket.org/MatthewTurk/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Matt Turk",
        "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
        "username": "MatthewTurk"
    },
    "source": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/MatthewTurk/yt/commit/8a49c0dfa0c3"
                }
            },
            "hash": "8a49c0dfa0c3"
        },
        "repository": {
            "full_name": "MatthewTurk/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/MatthewTurk/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/MatthewTurk/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/MatthewTurk/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b5dfa70b-707c-4330-92a8-e3ea1bee18b3}"
        }
    },
    "close_source_branch": false,
    "destination": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/ad6d4f04b990"
                }
            },
            "hash": "ad6d4f04b990"
        },
        "repository": {
            "full_name": "yt_analysis/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/yt_analysis/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b73cb37c-40f2-493a-aaa9-41bc8d8974cc}"
        }
    },
    "comments": [
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/comments/16057147"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059/_/diff#comment-16057147"
                }
            },
            "pullrequest": {
                "title": "Experimental derived field caching",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059"
                    }
                },
                "id": 2059
            },
            "content": {
                "raw": "Something went wrong, you should checkout https://tests.yt-project.org/job/yt_testsuite/129/",
                "html": "<p>Something went wrong, you should checkout <a href=\"https://tests.yt-project.org/job/yt_testsuite/129/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/129/</a></p>",
                "markup": "markdown"
            },
            "created_on": "2016-03-21T20:34:20.348751+00:00",
            "updated_on": "2016-03-21T20:34:20.416125+00:00",
            "id": 16057147
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/comments/16065429"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059/_/diff#comment-16065429"
                }
            },
            "pullrequest": {
                "title": "Experimental derived field caching",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059"
                    }
                },
                "id": 2059
            },
            "content": {
                "raw": "Something went wrong, you should checkout https://tests.yt-project.org/job/yt_testsuite/139/",
                "html": "<p>Something went wrong, you should checkout <a href=\"https://tests.yt-project.org/job/yt_testsuite/139/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/139/</a></p>",
                "markup": "markdown"
            },
            "created_on": "2016-03-22T01:36:55.915164+00:00",
            "updated_on": "2016-03-22T01:36:56.090660+00:00",
            "id": 16065429
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
                    },
                    "html": {
                        "href": "https://bitbucket.org/MatthewTurk/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Matthew Turk",
                "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
                "username": "MatthewTurk"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/comments/16065458"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059/_/diff#comment-16065458"
                }
            },
            "pullrequest": {
                "title": "Experimental derived field caching",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059"
                    }
                },
                "id": 2059
            },
            "content": {
                "raw": "Getting closer now, but a handful of issues remaining, most related to units.  I'll keep poking at this.",
                "html": "<p>Getting closer now, but a handful of issues remaining, most related to units.  I'll keep poking at this.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-03-22T01:39:35.414869+00:00",
            "updated_on": "2016-03-22T01:39:35.417116+00:00",
            "id": 16065458
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/comments/16065860"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059/_/diff#comment-16065860"
                }
            },
            "pullrequest": {
                "title": "Experimental derived field caching",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059"
                    }
                },
                "id": 2059
            },
            "content": {
                "raw": "Something went wrong, you should checkout https://tests.yt-project.org/job/yt_testsuite/140/",
                "html": "<p>Something went wrong, you should checkout <a href=\"https://tests.yt-project.org/job/yt_testsuite/140/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/140/</a></p>",
                "markup": "markdown"
            },
            "created_on": "2016-03-22T02:11:51.075645+00:00",
            "updated_on": "2016-03-22T02:11:51.145152+00:00",
            "id": 16065860
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
                    },
                    "html": {
                        "href": "https://bitbucket.org/MatthewTurk/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Matthew Turk",
                "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
                "username": "MatthewTurk"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059/comments/16327695"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059/_/diff#comment-16327695"
                }
            },
            "pullrequest": {
                "title": "Experimental derived field caching",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2059"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2059"
                    }
                },
                "id": 2059
            },
            "content": {
                "raw": "So I understand all of the test failures, and they actually seem to be ... the desired behavior for this feature.\n\nIt pains me to say this, but unless there's enough time to figure out how we want to manage things like that, I think I'd like to see this get put off until after a 3.3 release.  The specific failure is the setting of one field to one unit and another dataset having different units.  In this modification, they'd be the same object so they'd have the same units.",
                "html": "<p>So I understand all of the test failures, and they actually seem to be ... the desired behavior for this feature.</p>\n<p>It pains me to say this, but unless there's enough time to figure out how we want to manage things like that, I think I'd like to see this get put off until after a 3.3 release.  The specific failure is the setting of one field to one unit and another dataset having different units.  In this modification, they'd be the same object so they'd have the same units.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-03-27T21:28:05.772425+00:00",
            "updated_on": "2016-03-27T21:28:05.777292+00:00",
            "id": 16327695
        }
    ]
}