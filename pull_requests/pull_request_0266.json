{
    "reason": "",
    "state": "MERGED",
    "updated_on": "2012-09-08T17:19:41.268888+00:00",
    "comment_count": 9,
    "description": "Pulled in Stephen's modifications, and everything works nicely, creating identical halo merger tree databases for the Enzo_64 dataset.",
    "created_on": "2012-09-05T21:14:00.261092+00:00",
    "task_count": 0,
    "merge_commit": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/5e78fb4e3812"
            }
        },
        "hash": "5e78fb4e3812"
    },
    "title": "Merger Tree performance improvement",
    "links": {
        "diff": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/diff"
        },
        "decline": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/decline"
        },
        "self": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
        },
        "activity": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/activity"
        },
        "merge": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/merge"
        },
        "commits": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/commits"
        },
        "statuses": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/statuses"
        },
        "approve": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/approve"
        },
        "html": {
            "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
        },
        "comments": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments"
        }
    },
    "closed_by": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/sskory"
            },
            "html": {
                "href": "https://bitbucket.org/sskory/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/sskory/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Stephen Skory",
        "uuid": "{11787434-dea2-42d8-b94d-88d347eb151a}",
        "username": "sskory"
    },
    "id": 266,
    "type": "pullrequest",
    "author": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/bcrosby"
            },
            "html": {
                "href": "https://bitbucket.org/bcrosby/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/bcrosby/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Brian Crosby",
        "uuid": "{1a211525-75b5-4ae1-9e13-cd5d284394ae}",
        "username": "bcrosby"
    },
    "source": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/bcrosby/crosby/commit/80c20f67f390"
                }
            },
            "hash": "80c20f67f390"
        },
        "repository": {
            "full_name": "bcrosby/crosby",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/bcrosby/crosby"
                },
                "html": {
                    "href": "https://bitbucket.org/bcrosby/crosby"
                },
                "avatar": {
                    "href": "https://bitbucket.org/bcrosby/crosby/avatar/32/"
                }
            },
            "name": "crosby",
            "uuid": "{a957f877-d14f-479e-ae9e-3b97b491bba5}"
        }
    },
    "close_source_branch": false,
    "destination": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/551e1238ab38"
                }
            },
            "hash": "551e1238ab38"
        },
        "repository": {
            "full_name": "yt_analysis/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/yt_analysis/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b73cb37c-40f2-493a-aaa9-41bc8d8974cc}"
        }
    },
    "comments": [
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/sskory"
                    },
                    "html": {
                        "href": "https://bitbucket.org/sskory/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/sskory/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Stephen Skory",
                "uuid": "{11787434-dea2-42d8-b94d-88d347eb151a}",
                "username": "sskory"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16749"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16749"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Super, Brian. I'll take a look at this soon!",
                "html": "<p>Super, Brian. I'll take a look at this soon!</p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-05T21:15:32.532348+00:00",
            "updated_on": "2012-09-05T21:15:32.542854+00:00",
            "id": 16749
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/sskory"
                    },
                    "html": {
                        "href": "https://bitbucket.org/sskory/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/sskory/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Stephen Skory",
                "uuid": "{11787434-dea2-42d8-b94d-88d347eb151a}",
                "username": "sskory"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16750"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16750"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Oh, out of curiosity, what kind of performance gains are you seeing with these changes?",
                "html": "<p>Oh, out of curiosity, what kind of performance gains are you seeing with these changes?</p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-05T21:18:35.150026+00:00",
            "updated_on": "2012-09-05T21:18:35.156384+00:00",
            "id": 16750
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
                    },
                    "html": {
                        "href": "https://bitbucket.org/MatthewTurk/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Matthew Turk",
                "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
                "username": "MatthewTurk"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16758"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16758"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Hi Stephen -- my guess is that this should result in pretty big speedups.  If you think about it, it makes sense that this would be faster, as well.  In the old way, not only were Nhalo*2 arrays being allocated of increasing size (the first set of which were each slightly longer than the previous, the second set of which are the arrays being read from disk) but the first set of halo particles gets copied over (verbatim) Nhalo times, the second set Nhalo-1 times, etc etc.  I think this one is a slamdunk!",
                "html": "<p>Hi Stephen -- my guess is that this should result in pretty big speedups.  If you think about it, it makes sense that this would be faster, as well.  In the old way, not only were Nhalo*2 arrays being allocated of increasing size (the first set of which were each slightly longer than the previous, the second set of which are the arrays being read from disk) but the first set of halo particles gets copied over (verbatim) Nhalo times, the second set Nhalo-1 times, etc etc.  I think this one is a slamdunk!</p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-05T21:58:36.642537+00:00",
            "updated_on": "2012-09-05T21:58:36.649127+00:00",
            "id": 16758
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/sskory"
                    },
                    "html": {
                        "href": "https://bitbucket.org/sskory/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/sskory/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Stephen Skory",
                "uuid": "{11787434-dea2-42d8-b94d-88d347eb151a}",
                "username": "sskory"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16858"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16858"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Hi Brian, I have taken a closer look and noticed a couple things:\n\n  * Your changes do not work in parallel for me, which may or may not be related to the other issues I've identified below.\n  * At line 473 of your new file, I believe parent_masses should be float64. Similarly, you may need to specify type for your concatenates at lines 476-478.\n  * In serial with your changes, I am getting different answers than I do with the current version. I am using this script to compare the old and new versions of the database: http://paste.yt-project.org/show/2677/ \n\nI think you're right that sorting the arrays isn't required because _match is using np.in1d - so nice catch!",
                "html": "<p>Hi Brian, I have taken a closer look and noticed a couple things:</p>\n<ul><li>Your changes do not work in parallel for me, which may or may not be related to the other issues I've identified below.\n</li><li>At line 473 of your new file, I believe parent_masses should be float64. Similarly, you may need to specify type for your concatenates at lines 476-478.\n</li><li>In serial with your changes, I am getting different answers than I do with the current version. I am using this script to compare the old and new versions of the database: <a href=\"http://paste.yt-project.org/show/2677/\">http://paste.yt-project.org/show/2677/</a> \n</li></ul>\n<p>I think you're right that sorting the arrays isn't required because _match is using np.in1d - so nice catch!</p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-06T16:16:33.842634+00:00",
            "updated_on": "2012-09-06T16:16:33.850700+00:00",
            "id": 16858
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/sskory"
                    },
                    "html": {
                        "href": "https://bitbucket.org/sskory/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/sskory/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Stephen Skory",
                "uuid": "{11787434-dea2-42d8-b94d-88d347eb151a}",
                "username": "sskory"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16860"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16860"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16858"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16858"
                    }
                },
                "id": 16858
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Oops, I had some wrong indents, try this http://paste.yt-project.org/show/2678/",
                "html": "<p>Oops, I had some wrong indents, try this <a href=\"http://paste.yt-project.org/show/2678/\">http://paste.yt-project.org/show/2678/</a></p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-06T16:21:19.949586+00:00",
            "updated_on": "2012-09-06T16:21:19.956199+00:00",
            "id": 16860
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/bcrosby"
                    },
                    "html": {
                        "href": "https://bitbucket.org/bcrosby/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/bcrosby/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Brian Crosby",
                "uuid": "{1a211525-75b5-4ae1-9e13-cd5d284394ae}",
                "username": "bcrosby"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/16877"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-16877"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Thanks for the checking Stephen, I'll take a look at this and see what I can work out.",
                "html": "<p>Thanks for the checking Stephen, I'll take a look at this and see what I can work out.</p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-06T17:20:23.613827+00:00",
            "updated_on": "2012-09-06T17:20:23.722447+00:00",
            "id": 16877
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
                    },
                    "html": {
                        "href": "https://bitbucket.org/MatthewTurk/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Matthew Turk",
                "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
                "username": "MatthewTurk"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/17025"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-17025"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "I'd like to understand why \"extend\" works and \"append\" doesn't.  I would guess it's extremely slow, since it should be adding tons of new items to the list:\n\nhttp://docs.python.org/tutorial/datastructures.html",
                "html": "<p>I'd like to understand why \"extend\" works and \"append\" doesn't.  I would guess it's extremely slow, since it should be adding tons of new items to the list:</p>\n<p><a href=\"http://docs.python.org/tutorial/datastructures.html\">http://docs.python.org/tutorial/datastructures.html</a></p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-07T18:14:35.912950+00:00",
            "updated_on": "2012-09-07T18:14:35.923612+00:00",
            "id": 17025
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
                    },
                    "html": {
                        "href": "https://bitbucket.org/MatthewTurk/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Matthew Turk",
                "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
                "username": "MatthewTurk"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/17027"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-17027"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/17025"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-17025"
                    }
                },
                "id": 17025
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Let me be more clear: I don't understand why these are different:\n\n{{{\na = na.empty([], dtype='float64')\nfor particle_list in particle_lists:\n    a = na.concatenate((a, particle_list))\n}}}\n\nand\n\n{{{\na = []\nfor particle_list in particle_lists:\n    a.append(particle_list)\na = na.concatenate(a)\n}}}",
                "html": "<p>Let me be more clear: I don't understand why these are different:</p>\n<pre>a = na.empty([], dtype='float64')\nfor particle_list in particle_lists:\n    a = na.concatenate((a, particle_list))\n</pre>\n<p>and</p>\n<pre>a = []\nfor particle_list in particle_lists:\n    a.append(particle_list)\na = na.concatenate(a)\n</pre>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-07T18:18:45.132887+00:00",
            "updated_on": "2012-09-07T18:18:45.141857+00:00",
            "id": 17027
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/sskory"
                    },
                    "html": {
                        "href": "https://bitbucket.org/sskory/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/sskory/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Stephen Skory",
                "uuid": "{11787434-dea2-42d8-b94d-88d347eb151a}",
                "username": "sskory"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266/comments/17079"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266/_/diff#comment-17079"
                }
            },
            "pullrequest": {
                "title": "Merger Tree performance improvement",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/266"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/266"
                    }
                },
                "id": 266
            },
            "content": {
                "raw": "Note that as part of this PR, I swapped out the fortran kdtree for the cython one. Although the cython one is slower, it's not a big enough speed difference for the small numbers of halos to make the fortran kdtree hassle worth it.\n\nThis means that for this issue (https://bitbucket.org/yt_analysis/yt/issue/413/use-scipyspatialckdtree-in-more-places) all that is left is the two point functions. I'll have to think harder about that one because it may still be worth the fortran hassle there (and fewer/no people use that stuff anyway).\n\nAnyway, thanks Brian, accepted!",
                "html": "<p>Note that as part of this PR, I swapped out the fortran kdtree for the cython one. Although the cython one is slower, it's not a big enough speed difference for the small numbers of halos to make the fortran kdtree hassle worth it.</p>\n<p>This means that for this issue (<a href=\"https://bitbucket.org/yt_analysis/yt/issue/413/use-scipyspatialckdtree-in-more-places\">https://bitbucket.org/yt_analysis/yt/issue/413/use-scipyspatialckdtree-in-more-places</a>) all that is left is the two point functions. I'll have to think harder about that one because it may still be worth the fortran hassle there (and fewer/no people use that stuff anyway).</p>\n<p>Anyway, thanks Brian, accepted!</p>\n",
                "markup": "creole"
            },
            "created_on": "2012-09-08T17:19:32.398689+00:00",
            "updated_on": "2012-09-08T17:19:32.406707+00:00",
            "id": 17079
        }
    ]
}