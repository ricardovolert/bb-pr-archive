{
    "reason": "",
    "state": "MERGED",
    "updated_on": "2015-08-20T16:16:19.274748+00:00",
    "comment_count": 8,
    "description": "This parallelizes the loop over absorption lines as well as the loop over all lixels for depositing a single absorption line.  This adds an ``njobs`` keyword to ``make_spectrum`` to control the number of process group over which to divide the loop over lines.  For total processors, N, the inner deposition loop will be parallelized over (N/``njobs``) processors.  In the case where the user wants to make multiple spectra, they can also parallelize over multiple spectra by looping with a ``parallel_objects`` call.\r\n\r\n@chummels, @devinsilvia, if you could test this out and let me know what kind of speedup you see, that would be very helpful.  Additional note, combining the line lists seems to be quite slow.  I suggest trying this with setting ``line_list_file``=None.\r\n\r\nUpdate 1: I set the default ``njobs`` in ``make_spectrum`` to \"auto\".  This will try to parallelize the loop over lines as much as possible first, and will then only try to parallelize the deposition if there are more processors than lines.  This should be the optimal strategy and will not require the user to change anything if they change the number of processors.\r\n",
    "created_on": "2015-07-31T07:39:31.380270+00:00",
    "task_count": 0,
    "merge_commit": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/1e76952e015d"
            }
        },
        "hash": "1e76952e015d"
    },
    "title": "Multi-level parallelism for absorption spectrum generator",
    "links": {
        "diff": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/diff"
        },
        "decline": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/decline"
        },
        "self": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
        },
        "activity": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/activity"
        },
        "merge": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/merge"
        },
        "commits": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/commits"
        },
        "statuses": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/statuses"
        },
        "approve": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/approve"
        },
        "html": {
            "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
        },
        "comments": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments"
        }
    },
    "closed_by": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
            },
            "html": {
                "href": "https://bitbucket.org/ngoldbaum/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Nathan Goldbaum",
        "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
        "username": "ngoldbaum"
    },
    "id": 1665,
    "type": "pullrequest",
    "author": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/brittonsmith"
            },
            "html": {
                "href": "https://bitbucket.org/brittonsmith/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/brittonsmith/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Britton Smith",
        "uuid": "{94333901-a436-4c2c-8322-8d09e387eece}",
        "username": "brittonsmith"
    },
    "source": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/brittonsmith/yt/commit/0ec4255424db"
                }
            },
            "hash": "0ec4255424db"
        },
        "repository": {
            "full_name": "brittonsmith/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/brittonsmith/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/brittonsmith/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/brittonsmith/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{a3a98ec1-6936-4db5-8667-658e17c1eaca}"
        }
    },
    "close_source_branch": false,
    "destination": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/e0b16d0403a7"
                }
            },
            "hash": "e0b16d0403a7"
        },
        "repository": {
            "full_name": "yt_analysis/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/yt_analysis/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b73cb37c-40f2-493a-aaa9-41bc8d8974cc}"
        }
    },
    "comments": [
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/8714225"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-8714225"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "All tests pass. Good job!",
                "html": "<p>All tests pass. Good job!</p>",
                "markup": "markdown"
            },
            "created_on": "2015-07-31T22:41:00.272966+00:00",
            "updated_on": "2015-07-31T22:41:00.329754+00:00",
            "id": 8714225
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/8714569"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-8714569"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "All tests pass. Good job!",
                "html": "<p>All tests pass. Good job!</p>",
                "markup": "markdown"
            },
            "created_on": "2015-07-31T23:18:18.665280+00:00",
            "updated_on": "2015-07-31T23:18:18.725667+00:00",
            "id": 8714569
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/devinsilvia"
                    },
                    "html": {
                        "href": "https://bitbucket.org/devinsilvia/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/devinsilvia/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Devin Silvia",
                "uuid": "{de10a23c-34a0-4f76-a031-b5ec3b2a34db}",
                "username": "devinsilvia"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/8941862"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-8941862"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "It looks like this functions and there is decent speed up.  For a shortened line list (27 lines) the spectrum generation only took 5 minutes running on that many cores, basically the time for the longest line.  On a single core this would likely take over 2 hours.  The true speed up for doing all the lines will be dependent on how long each individual line takes and the total number of lines, but it will still be faster.  I don't see any reason why this can't go in.",
                "html": "<p>It looks like this functions and there is decent speed up.  For a shortened line list (27 lines) the spectrum generation only took 5 minutes running on that many cores, basically the time for the longest line.  On a single core this would likely take over 2 hours.  The true speed up for doing all the lines will be dependent on how long each individual line takes and the total number of lines, but it will still be faster.  I don't see any reason why this can't go in.</p>",
                "markup": "markdown"
            },
            "created_on": "2015-08-10T12:58:07.145149+00:00",
            "updated_on": "2015-08-10T12:58:07.200491+00:00",
            "id": 8941862
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/xarthisius"
                    },
                    "html": {
                        "href": "https://bitbucket.org/xarthisius/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/xarthisius/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Kacper Kowalik",
                "uuid": "{26af8f1d-35b3-46ce-9939-09915b06e31f}",
                "username": "xarthisius"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/8950509"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-8950509"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "@devinsilvia could you share with me `lightray.h5` and script to reproduce locally the longest line analysis that takes 5m?",
                "html": "<p><a href=\"/devinsilvia/\" rel=\"nofollow\" title=\"@devinsilvia\" class=\"mention\">Devin Silvia</a> could you share with me <code>lightray.h5</code> and script to reproduce locally the longest line analysis that takes 5m?</p>",
                "markup": "markdown"
            },
            "created_on": "2015-08-10T16:14:30.298152+00:00",
            "updated_on": "2015-08-10T16:14:30.318124+00:00",
            "id": 8950509
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/8951256"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-8951256"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "All tests pass. Good job!",
                "html": "<p>All tests pass. Good job!</p>",
                "markup": "markdown"
            },
            "created_on": "2015-08-10T16:33:31.835146+00:00",
            "updated_on": "2015-08-10T16:33:31.896669+00:00",
            "id": 8951256
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/8952462"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-8952462"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "Docs were built for this PR. See http://hub.yt:8080/job/yt_docs/199/",
                "html": "<p>Docs were built for this PR. See <a href=\"http://hub.yt:8080/job/yt_docs/199/\" rel=\"nofollow\">http://hub.yt:8080/job/yt_docs/199/</a></p>",
                "markup": "markdown"
            },
            "created_on": "2015-08-10T17:06:13.674514+00:00",
            "updated_on": "2015-08-10T17:06:13.746263+00:00",
            "id": 8952462
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/MatthewTurk"
                    },
                    "html": {
                        "href": "https://bitbucket.org/MatthewTurk/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/MatthewTurk/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Matthew Turk",
                "uuid": "{b3f0b280-55fc-4e8a-8bd1-40478d4cbdbf}",
                "username": "MatthewTurk"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/9070566"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-9070566"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "@chummels will be testing this and will approve when he is done.",
                "html": "<p><a href=\"/chummels/\" rel=\"nofollow\" title=\"@chummels\" class=\"mention\">Cameron Hummels</a> will be testing this and will approve when he is done.</p>",
                "markup": "markdown"
            },
            "created_on": "2015-08-13T16:32:12.456892+00:00",
            "updated_on": "2015-08-13T16:32:12.483416+00:00",
            "id": 9070566
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/chummels"
                    },
                    "html": {
                        "href": "https://bitbucket.org/chummels/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/chummels/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Cameron Hummels",
                "uuid": "{de871bb8-32e9-450a-b8c9-2b49a1334f16}",
                "username": "chummels"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665/comments/9114797"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665/_/diff#comment-9114797"
                }
            },
            "pullrequest": {
                "title": "Multi-level parallelism for absorption spectrum generator",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/1665"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/1665"
                    }
                },
                "id": 1665
            },
            "content": {
                "raw": "I've now gone through and tested this on some large sample datasets.  I can report that the parallelization works well, with similar results to what @devinsilvia finds: runtime seems to scale linearly with the inverse of the processor count when depositing more lines than processors.  When using fewer lines than processors, the speedup isn't quite linear, but it almost is.\n\nIn my opinion, this is ready to be merged.  Thanks for the work on this, @brittonsmith !  Definitely an improvement.",
                "html": "<p>I've now gone through and tested this on some large sample datasets.  I can report that the parallelization works well, with similar results to what <a href=\"/devinsilvia/\" rel=\"nofollow\" title=\"@devinsilvia\" class=\"mention\">Devin Silvia</a> finds: runtime seems to scale linearly with the inverse of the processor count when depositing more lines than processors.  When using fewer lines than processors, the speedup isn't quite linear, but it almost is.</p>\n<p>In my opinion, this is ready to be merged.  Thanks for the work on this, <a href=\"/brittonsmith/\" rel=\"nofollow\" title=\"@brittonsmith\" class=\"mention\">Britton Smith</a> !  Definitely an improvement.</p>",
                "markup": "markdown"
            },
            "created_on": "2015-08-15T01:29:21.844786+00:00",
            "updated_on": "2015-08-15T01:29:21.872186+00:00",
            "id": 9114797
        }
    ]
}