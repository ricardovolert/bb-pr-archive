{
    "reason": "",
    "state": "MERGED",
    "updated_on": "2017-03-14T13:27:03.820665+00:00",
    "comment_count": 8,
    "description": "Experimental...my first attempt at context managers. From what I can tell this overcomes the file limit in issue #1328. However, when trying to load around 1000 exodus files (all identical with size 20 kB) with `sim.get_time_series()`, I consumed 20 GB of memory and had to interrupt before `get_time_series()` was complete.",
    "created_on": "2017-03-08T20:44:00.697105+00:00",
    "task_count": 0,
    "merge_commit": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/95401107ce07"
            }
        },
        "hash": "95401107ce07"
    },
    "title": "Close netCDF4 datasets when not being used.",
    "links": {
        "diff": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/diff"
        },
        "decline": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/decline"
        },
        "self": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
        },
        "activity": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/activity"
        },
        "merge": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/merge"
        },
        "commits": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/commits"
        },
        "statuses": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/statuses"
        },
        "approve": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/approve"
        },
        "html": {
            "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
        },
        "comments": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments"
        }
    },
    "closed_by": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/xarthisius"
            },
            "html": {
                "href": "https://bitbucket.org/xarthisius/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/xarthisius/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Kacper Kowalik",
        "uuid": "{26af8f1d-35b3-46ce-9939-09915b06e31f}",
        "username": "xarthisius"
    },
    "id": 2542,
    "type": "pullrequest",
    "author": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/al007"
            },
            "html": {
                "href": "https://bitbucket.org/al007/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/al007/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Alexander Lindsay",
        "uuid": "{b2a7dd50-e363-4a2a-8c27-373e326a2a8b}",
        "username": "al007"
    },
    "source": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/al007/yt/commit/24a55c267d85"
                }
            },
            "hash": "24a55c267d85"
        },
        "repository": {
            "full_name": "al007/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/al007/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/al007/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/al007/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{6dc30622-355d-4bc1-b889-91a409eaa4e8}"
        }
    },
    "close_source_branch": false,
    "destination": {
        "branch": {
            "name": "yt"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/f3015d6048eb"
                }
            },
            "hash": "f3015d6048eb"
        },
        "repository": {
            "full_name": "yt_analysis/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/yt_analysis/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b73cb37c-40f2-493a-aaa9-41bc8d8974cc}"
        }
    },
    "comments": [
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
                    },
                    "html": {
                        "href": "https://bitbucket.org/ngoldbaum/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Nathan Goldbaum",
                "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
                "username": "ngoldbaum"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/32811446"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-32811446"
                }
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "Python memory leaks are fun! Next week when I'm back in town would you be interested in a pair programming session to ferret that out? I have some experience debugging similar issues.",
                "html": "<p>Python memory leaks are fun! Next week when I'm back in town would you be interested in a pair programming session to ferret that out? I have some experience debugging similar issues.</p>",
                "markup": "markdown"
            },
            "created_on": "2017-03-08T21:17:13.170946+00:00",
            "updated_on": "2017-03-08T21:17:13.173517+00:00",
            "id": 32811446
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/al007"
                    },
                    "html": {
                        "href": "https://bitbucket.org/al007/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/al007/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Alexander Lindsay",
                "uuid": "{b2a7dd50-e363-4a2a-8c27-373e326a2a8b}",
                "username": "al007"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/32811851"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-32811851"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/32811446"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-32811446"
                    }
                },
                "id": 32811446
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "That would be awesome. Let me know a good time for you; my schedule is pretty flexible\n",
                "html": "<p>That would be awesome. Let me know a good time for you; my schedule is pretty flexible</p>",
                "markup": "markdown"
            },
            "created_on": "2017-03-08T21:25:09.687846+00:00",
            "updated_on": "2017-03-08T21:28:24.931256+00:00",
            "id": 32811851
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/yt-fido"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt-fido/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/yt-fido/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "yt-fido",
                "uuid": "{da2aa332-3f05-45c9-ae53-ff5ba34b35ce}",
                "username": "yt-fido"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/32812318"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-32812318"
                }
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "* All tests pass. Good job! https://tests.yt-project.org/job/yt_testsuite/656/\n* Something went wrong, you should checkout https://tests.yt-project.org/job/yt_testsuite/665/\n* All tests pass. Good job! https://tests.yt-project.org/job/yt_testsuite/666/\n* All tests pass. Good job! https://tests.yt-project.org/job/yt_testsuite/667/\n",
                "html": "<ul>\n<li>All tests pass. Good job! <a href=\"https://tests.yt-project.org/job/yt_testsuite/656/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/656/</a></li>\n<li>Something went wrong, you should checkout <a href=\"https://tests.yt-project.org/job/yt_testsuite/665/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/665/</a></li>\n<li>All tests pass. Good job! <a href=\"https://tests.yt-project.org/job/yt_testsuite/666/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/666/</a></li>\n<li>All tests pass. Good job! <a href=\"https://tests.yt-project.org/job/yt_testsuite/667/\" rel=\"nofollow\">https://tests.yt-project.org/job/yt_testsuite/667/</a></li>\n</ul>",
                "markup": "markdown"
            },
            "created_on": "2017-03-08T21:33:09.800207+00:00",
            "updated_on": "2017-03-14T02:38:31.571236+00:00",
            "id": 32812318
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/al007"
                    },
                    "html": {
                        "href": "https://bitbucket.org/al007/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/al007/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Alexander Lindsay",
                "uuid": "{b2a7dd50-e363-4a2a-8c27-373e326a2a8b}",
                "username": "al007"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/33076233"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-33076233"
                }
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "@ngoldbaum it looks like this most recent commit really did actually do something good. Here's what happens if I run this script:\n```python\nwith memory_checker(1):\n    time.sleep(2)\n    sim = yt.simulation(\"hundred_files\", \"ExodusII\")\n    sim.get_time_series()\n    time.sleep(2)\n```\n## Before PR\n### First run after kernel restart\n- Start memory: 1.063e-1 gb\n- End memory: 2.243e0 gb\n### Second run after kernel restart\n- Start memory: 2.243e0 gb\n- End memory: 4.383e0 gb\n\n## After PR\n### First run after kernel restart\n- Start memory: 1.062e-1 gb\n- End memory: 2.588e-1 gb\n### Second run after kernel restart\n- Start memory: 2.591e-1 gb\n- End memory: 2.606e-1 gb",
                "html": "<p><a href=\"/ngoldbaum/\" rel=\"nofollow\" title=\"@ngoldbaum\" class=\"mention\">Nathan Goldbaum</a> it looks like this most recent commit really did actually do something good. Here's what happens if I run this script:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"k\">with</span> <span class=\"n\">memory_checker</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">):</span>\n    <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n    <span class=\"n\">sim</span> <span class=\"o\">=</span> <span class=\"n\">yt</span><span class=\"o\">.</span><span class=\"n\">simulation</span><span class=\"p\">(</span><span class=\"s2\">&quot;hundred_files&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;ExodusII&quot;</span><span class=\"p\">)</span>\n    <span class=\"n\">sim</span><span class=\"o\">.</span><span class=\"n\">get_time_series</span><span class=\"p\">()</span>\n    <span class=\"n\">time</span><span class=\"o\">.</span><span class=\"n\">sleep</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<h2 id=\"markdown-header-before-pr\">Before PR</h2>\n<h3 id=\"markdown-header-first-run-after-kernel-restart\">First run after kernel restart</h3>\n<ul>\n<li>Start memory: 1.063e-1 gb</li>\n<li>End memory: 2.243e0 gb</li>\n</ul>\n<h3 id=\"markdown-header-second-run-after-kernel-restart\">Second run after kernel restart</h3>\n<ul>\n<li>Start memory: 2.243e0 gb</li>\n<li>End memory: 4.383e0 gb</li>\n</ul>\n<h2 id=\"markdown-header-after-pr\">After PR</h2>\n<h3 id=\"markdown-header-first-run-after-kernel-restart_1\">First run after kernel restart</h3>\n<ul>\n<li>Start memory: 1.062e-1 gb</li>\n<li>End memory: 2.588e-1 gb</li>\n</ul>\n<h3 id=\"markdown-header-second-run-after-kernel-restart_1\">Second run after kernel restart</h3>\n<ul>\n<li>Start memory: 2.591e-1 gb</li>\n<li>End memory: 2.606e-1 gb</li>\n</ul>",
                "markup": "markdown"
            },
            "created_on": "2017-03-14T00:26:40.254811+00:00",
            "updated_on": "2017-03-14T00:26:40.334228+00:00",
            "id": 33076233
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/al007"
                    },
                    "html": {
                        "href": "https://bitbucket.org/al007/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/al007/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Alexander Lindsay",
                "uuid": "{b2a7dd50-e363-4a2a-8c27-373e326a2a8b}",
                "username": "al007"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/33076528"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-33076528"
                }
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "Just tried `get_time_series()` with 1000 files...only used 16 MB :-)",
                "html": "<p>Just tried <code>get_time_series()</code> with 1000 files...only used 16 MB :-)</p>",
                "markup": "markdown"
            },
            "created_on": "2017-03-14T00:36:59.970805+00:00",
            "updated_on": "2017-03-14T00:37:00.011939+00:00",
            "id": 33076528
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
                    },
                    "html": {
                        "href": "https://bitbucket.org/ngoldbaum/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Nathan Goldbaum",
                "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
                "username": "ngoldbaum"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/33078994"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-33078994"
                }
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "@atmyers would you mind looking this over?",
                "html": "<p><a href=\"/atmyers/\" rel=\"nofollow\" title=\"@atmyers\" class=\"mention\">Andrew Myers</a> would you mind looking this over?</p>",
                "markup": "markdown"
            },
            "created_on": "2017-03-14T02:13:26.342958+00:00",
            "updated_on": "2017-03-14T02:13:26.349106+00:00",
            "id": 33078994
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/atmyers"
                    },
                    "html": {
                        "href": "https://bitbucket.org/atmyers/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/atmyers/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Andrew Myers",
                "uuid": "{651c5647-b78f-4cd9-8d9a-5d6e8c9ac8d3}",
                "username": "atmyers"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/33082380"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-33082380"
                }
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "Nice work! Could you explain why the memory usage grows on the first run, but not the second? ",
                "html": "<p>Nice work! Could you explain why the memory usage grows on the first run, but not the second? </p>",
                "markup": "markdown"
            },
            "created_on": "2017-03-14T04:30:35.472743+00:00",
            "updated_on": "2017-03-14T04:30:35.475187+00:00",
            "id": 33082380
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/atmyers"
                    },
                    "html": {
                        "href": "https://bitbucket.org/atmyers/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/atmyers/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Andrew Myers",
                "uuid": "{651c5647-b78f-4cd9-8d9a-5d6e8c9ac8d3}",
                "username": "atmyers"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/33082516"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-33082516"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542/comments/33082380"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542/_/diff#comment-33082380"
                    }
                },
                "id": 33082380
            },
            "pullrequest": {
                "title": "Close netCDF4 datasets when not being used.",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2542"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2542"
                    }
                },
                "id": 2542
            },
            "content": {
                "raw": "Bah, nevermind - I misread the numbers. This all looks great to me.",
                "html": "<p>Bah, nevermind - I misread the numbers. This all looks great to me.</p>",
                "markup": "markdown"
            },
            "created_on": "2017-03-14T04:36:04.315778+00:00",
            "updated_on": "2017-03-14T04:36:04.317929+00:00",
            "id": 33082516
        }
    ]
}