{
    "reason": "",
    "state": "MERGED",
    "updated_on": "2016-10-26T17:35:23.805235+00:00",
    "comment_count": 6,
    "description": "This backports a number of bugfixes in preparation for yt 3.3.2.\r\n\r\nI'm particularly appreciate it if @chummels or @brittonsmith could test this out on trident, since there are a number of absorption spectrum or light ray-specific bugfixes.",
    "created_on": "2016-09-12T22:20:11.024537+00:00",
    "task_count": 0,
    "merge_commit": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/472c5babbc8c178f1236284ee5a309fc89fea250"
            }
        },
        "hash": "472c5babbc8c178f1236284ee5a309fc89fea250"
    },
    "title": "Backport bugfixes for 3.3.2",
    "links": {
        "diff": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/diff"
        },
        "decline": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/decline"
        },
        "self": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
        },
        "activity": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/activity"
        },
        "merge": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/merge"
        },
        "commits": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/commits"
        },
        "statuses": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/statuses"
        },
        "approve": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/approve"
        },
        "html": {
            "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
        },
        "comments": {
            "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments"
        }
    },
    "closed_by": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
            },
            "html": {
                "href": "https://bitbucket.org/ngoldbaum/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Nathan Goldbaum",
        "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
        "username": "ngoldbaum"
    },
    "id": 2375,
    "type": "pullrequest",
    "author": {
        "links": {
            "self": {
                "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
            },
            "html": {
                "href": "https://bitbucket.org/ngoldbaum/"
            },
            "avatar": {
                "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
            }
        },
        "type": "user",
        "display_name": "Nathan Goldbaum",
        "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
        "username": "ngoldbaum"
    },
    "source": {
        "branch": {
            "name": "stable"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/ngoldbaum/yt/commit/83f72a489dae"
                }
            },
            "hash": "83f72a489dae"
        },
        "repository": {
            "full_name": "ngoldbaum/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/ngoldbaum/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/ngoldbaum/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/ngoldbaum/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{cb18d7d9-ab77-4e80-81ed-8d32a945e0ef}"
        }
    },
    "close_source_branch": false,
    "destination": {
        "branch": {
            "name": "stable"
        },
        "commit": {
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/commit/8752de74f4e3"
                }
            },
            "hash": "8752de74f4e3"
        },
        "repository": {
            "full_name": "yt_analysis/yt",
            "type": "repository",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt"
                },
                "avatar": {
                    "href": "https://bitbucket.org/yt_analysis/yt/avatar/32/"
                }
            },
            "name": "yt",
            "uuid": "{b73cb37c-40f2-493a-aaa9-41bc8d8974cc}"
        }
    },
    "comments": [
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/devinsilvia"
                    },
                    "html": {
                        "href": "https://bitbucket.org/devinsilvia/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/devinsilvia/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Devin Silvia",
                "uuid": "{de10a23c-34a0-4f76-a031-b5ec3b2a34db}",
                "username": "devinsilvia"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25296738"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25296738"
                }
            },
            "pullrequest": {
                "title": "Backport bugfixes for 3.3.2",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
                    }
                },
                "id": 2375
            },
            "content": {
                "raw": "I just ran the Trident testing suite with this PR and, as far as I can tell, everything functions as intended.",
                "html": "<p>I just ran the Trident testing suite with this PR and, as far as I can tell, everything functions as intended.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-10-17T16:46:32.938467+00:00",
            "updated_on": "2016-10-17T16:46:32.984367+00:00",
            "id": 25296738
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/devinsilvia"
                    },
                    "html": {
                        "href": "https://bitbucket.org/devinsilvia/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/devinsilvia/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Devin Silvia",
                "uuid": "{de10a23c-34a0-4f76-a031-b5ec3b2a34db}",
                "username": "devinsilvia"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25296791"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25296791"
                }
            },
            "pullrequest": {
                "title": "Backport bugfixes for 3.3.2",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
                    }
                },
                "id": 2375
            },
            "content": {
                "raw": "It would be useful if either @chummels or @brittonsmith could also confirm this.",
                "html": "<p>It would be useful if either <a href=\"/chummels/\" rel=\"nofollow\" title=\"@chummels\" class=\"mention\">chummels</a> or <a href=\"/brittonsmith/\" rel=\"nofollow\" title=\"@brittonsmith\" class=\"mention\">Britton Smith</a> could also confirm this.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-10-17T16:47:19.219880+00:00",
            "updated_on": "2016-10-17T16:47:27.010578+00:00",
            "id": 25296791
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/chummels"
                    },
                    "html": {
                        "href": "https://bitbucket.org/chummels/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/chummels/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "chummels",
                "uuid": "{de871bb8-32e9-450a-b8c9-2b49a1334f16}",
                "username": "chummels"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25592074"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25592074"
                }
            },
            "pullrequest": {
                "title": "Backport bugfixes for 3.3.2",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
                    }
                },
                "id": 2375
            },
            "content": {
                "raw": "OK, I've looked at this and done a bunch of testing with the stable version of Trident to see if this backport breaks anything.  It turns out that the tests run fine in trident, but that's because we don't have answer testing.  When I try our \"manual answer testing\" and compare against the result from using the old stable before these backports, I get a slight difference (only really visible when you toggle back and forth between the images).  I used hg bisect to narrow it down to a single changeset, but I'm not entirely sure if the difference I'm seeing is OK. \n\nFor reference, here are the steps I followed:\n\n\n```\n#!python\n\ncd $YT_HG\nhg up -r 8752de74f4e3 # the old stable tip\npython setup.py develop\ncd $TRIDENT\nhg up v0.5.1\ncd examples\npython working_script.py\nmv spec_raw.png spec_raw_good.png\ncd $YT_HG\nhg up 784bb3c # the tip from this PR\npython setup.py develop\ncd $TRIDENT/examples\npython working_script.py\nopen spec_raw.png spec_raw_good.png\n```\n\nWhen I do this, you can see a slight difference in the two raw spectra.  Basically, the new spectrum is slightly more stretched into the blue on the leftward side, indicating maybe a change in redshift?  You can see the images here, but it shows up better if you blink them:\n\nGood:\n![spec_raw.png](https://bitbucket.org/repo/BXbAb/images/850747442-spec_raw.png)\n\nNew:\n![spec_raw.png](https://bitbucket.org/repo/BXbAb/images/1850770533-spec_raw.png)\n\nUsing hg bisect, I was able to narrow the change down to this commit: 8846ebeea82d (https://bitbucket.org/yt_analysis/yt/commits/8846ebeea82d5f784d34cdc81534fef6c205a1aa?at=yt) from Britton's LightRay PR (https://bitbucket.org/yt_analysis/yt/pull-requests/2345).  But I'm not sure about it.  I guess the target distance by default in the old version wasn't in comoving coordinates?  But the working script trident is using is using a dataset with a really low redshift (i.e. z = 0.007), so presumably this would be a really small effect, which is I guess what we're seeing.  \n\n@brittonsmith What do you think?  Does this make sense?  Do we in fact want to be casting things to comoving coords and we were just doing it incorrectly in the old version?\n\nFor reference, the \"working_script\" we're using in Trident is as follows:\n\n\n```\n#!python\n\n# Example of a currently working script using trident to generate a COS\n# spectrum from a non-cosmological dataset\n\nimport os\nimport trident as tri\n\n# Define the dataset and the coordinates of the start/end of the ray\nfn = 'enzo_cosmology_plus/RD0009/RD0009'\nray_start = [0,0,0]\nray_end = [1,1,1]\n\n# Make a LightRay object for the temperature, density, and metallicity\n# fields of our dataset at redshift_start = redshift_end = 0.0.  Include\n# HI field calculated in simulation to override the Cloudy estimation of HI.\n# Save LightRay to ray.h5 and use it locally as ray object.\nray = tri.make_simple_ray(fn, start_position=ray_start,\n                          end_position=ray_end, data_filename='ray.h5',\n                          fields=['density', 'temperature', 'metallicity',\n                          'H_p0_number_density'])\n\n# Now use the ray object to actually generate an absorption spectrum\n# Use the settings (spectral range, LSF, and spectral resolution) for COS\n# And save it as an output hdf5 file and plot it to an image.\nsg = tri.SpectrumGenerator('COS')\nsg.make_spectrum(ray)\nsg.save_spectrum('spec_raw.h5')\nsg.plot_spectrum('spec_raw.png')\n\n# \"Final\" spectrum with added quasar, MW background, and gaussian noise\n# (SNR=30)\nsg.add_qso_spectrum()\nsg.add_milky_way_foreground()\nsg.apply_lsf()\nsg.add_gaussian_noise(30)\nsg.save_spectrum('spec_final.h5')\nsg.plot_spectrum('spec_final.png')\n```\n",
                "html": "<p>OK, I've looked at this and done a bunch of testing with the stable version of Trident to see if this backport breaks anything.  It turns out that the tests run fine in trident, but that's because we don't have answer testing.  When I try our \"manual answer testing\" and compare against the result from using the old stable before these backports, I get a slight difference (only really visible when you toggle back and forth between the images).  I used hg bisect to narrow it down to a single changeset, but I'm not entirely sure if the difference I'm seeing is OK. </p>\n<p>For reference, here are the steps I followed:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">cd</span> <span class=\"err\">$</span><span class=\"n\">YT_HG</span>\n<span class=\"n\">hg</span> <span class=\"n\">up</span> <span class=\"o\">-</span><span class=\"n\">r</span> <span class=\"mi\">8752</span><span class=\"n\">de74f4e3</span> <span class=\"c1\"># the old stable tip</span>\n<span class=\"n\">python</span> <span class=\"n\">setup</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"n\">develop</span>\n<span class=\"n\">cd</span> <span class=\"err\">$</span><span class=\"n\">TRIDENT</span>\n<span class=\"n\">hg</span> <span class=\"n\">up</span> <span class=\"n\">v0</span><span class=\"o\">.</span><span class=\"mf\">5.1</span>\n<span class=\"n\">cd</span> <span class=\"n\">examples</span>\n<span class=\"n\">python</span> <span class=\"n\">working_script</span><span class=\"o\">.</span><span class=\"n\">py</span>\n<span class=\"n\">mv</span> <span class=\"n\">spec_raw</span><span class=\"o\">.</span><span class=\"n\">png</span> <span class=\"n\">spec_raw_good</span><span class=\"o\">.</span><span class=\"n\">png</span>\n<span class=\"n\">cd</span> <span class=\"err\">$</span><span class=\"n\">YT_HG</span>\n<span class=\"n\">hg</span> <span class=\"n\">up</span> <span class=\"mi\">784</span><span class=\"n\">bb3c</span> <span class=\"c1\"># the tip from this PR</span>\n<span class=\"n\">python</span> <span class=\"n\">setup</span><span class=\"o\">.</span><span class=\"n\">py</span> <span class=\"n\">develop</span>\n<span class=\"n\">cd</span> <span class=\"err\">$</span><span class=\"n\">TRIDENT</span><span class=\"o\">/</span><span class=\"n\">examples</span>\n<span class=\"n\">python</span> <span class=\"n\">working_script</span><span class=\"o\">.</span><span class=\"n\">py</span>\n<span class=\"nb\">open</span> <span class=\"n\">spec_raw</span><span class=\"o\">.</span><span class=\"n\">png</span> <span class=\"n\">spec_raw_good</span><span class=\"o\">.</span><span class=\"n\">png</span>\n</pre></div>\n\n\n<p>When I do this, you can see a slight difference in the two raw spectra.  Basically, the new spectrum is slightly more stretched into the blue on the leftward side, indicating maybe a change in redshift?  You can see the images here, but it shows up better if you blink them:</p>\n<p>Good:\n<img alt=\"spec_raw.png\" src=\"https://bitbucket.org/repo/BXbAb/images/850747442-spec_raw.png\" /></p>\n<p>New:\n<img alt=\"spec_raw.png\" src=\"https://bitbucket.org/repo/BXbAb/images/1850770533-spec_raw.png\" /></p>\n<p>Using hg bisect, I was able to narrow the change down to this commit: <a href=\"/yt_analysis/yt/commits/8846ebeea82d\" rel=\"nofollow\">8846ebeea82d</a> (<a href=\"https://bitbucket.org/yt_analysis/yt/commits/8846ebeea82d5f784d34cdc81534fef6c205a1aa?at=yt\" rel=\"nofollow\">https://bitbucket.org/yt_analysis/yt/commits/8846ebeea82d5f784d34cdc81534fef6c205a1aa?at=yt</a>) from Britton's LightRay PR (<a href=\"https://bitbucket.org/yt_analysis/yt/pull-requests/2345\" rel=\"nofollow\">https://bitbucket.org/yt_analysis/yt/pull-requests/2345</a>).  But I'm not sure about it.  I guess the target distance by default in the old version wasn't in comoving coordinates?  But the working script trident is using is using a dataset with a really low redshift (i.e. z = 0.007), so presumably this would be a really small effect, which is I guess what we're seeing.  </p>\n<p><a href=\"/brittonsmith/\" rel=\"nofollow\" title=\"@brittonsmith\" class=\"mention\">Britton Smith</a> What do you think?  Does this make sense?  Do we in fact want to be casting things to comoving coords and we were just doing it incorrectly in the old version?</p>\n<p>For reference, the \"working_script\" we're using in Trident is as follows:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"c1\"># Example of a currently working script using trident to generate a COS</span>\n<span class=\"c1\"># spectrum from a non-cosmological dataset</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">os</span>\n<span class=\"kn\">import</span> <span class=\"nn\">trident</span> <span class=\"kn\">as</span> <span class=\"nn\">tri</span>\n\n<span class=\"c1\"># Define the dataset and the coordinates of the start/end of the ray</span>\n<span class=\"n\">fn</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;enzo_cosmology_plus/RD0009/RD0009&#39;</span>\n<span class=\"n\">ray_start</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"n\">ray_end</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n\n<span class=\"c1\"># Make a LightRay object for the temperature, density, and metallicity</span>\n<span class=\"c1\"># fields of our dataset at redshift_start = redshift_end = 0.0.  Include</span>\n<span class=\"c1\"># HI field calculated in simulation to override the Cloudy estimation of HI.</span>\n<span class=\"c1\"># Save LightRay to ray.h5 and use it locally as ray object.</span>\n<span class=\"n\">ray</span> <span class=\"o\">=</span> <span class=\"n\">tri</span><span class=\"o\">.</span><span class=\"n\">make_simple_ray</span><span class=\"p\">(</span><span class=\"n\">fn</span><span class=\"p\">,</span> <span class=\"n\">start_position</span><span class=\"o\">=</span><span class=\"n\">ray_start</span><span class=\"p\">,</span>\n                          <span class=\"n\">end_position</span><span class=\"o\">=</span><span class=\"n\">ray_end</span><span class=\"p\">,</span> <span class=\"n\">data_filename</span><span class=\"o\">=</span><span class=\"s1\">&#39;ray.h5&#39;</span><span class=\"p\">,</span>\n                          <span class=\"n\">fields</span><span class=\"o\">=</span><span class=\"p\">[</span><span class=\"s1\">&#39;density&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;temperature&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;metallicity&#39;</span><span class=\"p\">,</span>\n                          <span class=\"s1\">&#39;H_p0_number_density&#39;</span><span class=\"p\">])</span>\n\n<span class=\"c1\"># Now use the ray object to actually generate an absorption spectrum</span>\n<span class=\"c1\"># Use the settings (spectral range, LSF, and spectral resolution) for COS</span>\n<span class=\"c1\"># And save it as an output hdf5 file and plot it to an image.</span>\n<span class=\"n\">sg</span> <span class=\"o\">=</span> <span class=\"n\">tri</span><span class=\"o\">.</span><span class=\"n\">SpectrumGenerator</span><span class=\"p\">(</span><span class=\"s1\">&#39;COS&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">make_spectrum</span><span class=\"p\">(</span><span class=\"n\">ray</span><span class=\"p\">)</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">save_spectrum</span><span class=\"p\">(</span><span class=\"s1\">&#39;spec_raw.h5&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">plot_spectrum</span><span class=\"p\">(</span><span class=\"s1\">&#39;spec_raw.png&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># &quot;Final&quot; spectrum with added quasar, MW background, and gaussian noise</span>\n<span class=\"c1\"># (SNR=30)</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">add_qso_spectrum</span><span class=\"p\">()</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">add_milky_way_foreground</span><span class=\"p\">()</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">apply_lsf</span><span class=\"p\">()</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">add_gaussian_noise</span><span class=\"p\">(</span><span class=\"mi\">30</span><span class=\"p\">)</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">save_spectrum</span><span class=\"p\">(</span><span class=\"s1\">&#39;spec_final.h5&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">sg</span><span class=\"o\">.</span><span class=\"n\">plot_spectrum</span><span class=\"p\">(</span><span class=\"s1\">&#39;spec_final.png&#39;</span><span class=\"p\">)</span>\n</pre></div>",
                "markup": "markdown"
            },
            "created_on": "2016-10-21T22:19:13.311949+00:00",
            "updated_on": "2016-10-21T22:19:13.323071+00:00",
            "id": 25592074
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/brittonsmith"
                    },
                    "html": {
                        "href": "https://bitbucket.org/brittonsmith/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/brittonsmith/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Britton Smith",
                "uuid": "{94333901-a436-4c2c-8322-8d09e387eece}",
                "username": "brittonsmith"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25592727"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25592727"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25592074"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25592074"
                    }
                },
                "id": 25592074
            },
            "pullrequest": {
                "title": "Backport bugfixes for 3.3.2",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
                    }
                },
                "id": 2375
            },
            "content": {
                "raw": "@chummels, yes, I believe the change is correct and the previous behavior was wrong.  That changeset, which added the following line:\n\n```\n#!python\n\ntarget_distance = self.cosmology.quan(target_distance.to(\"Mpccm / h\"))\n```\n\nwas fixing the bug reported in [Issue #1258](https://bitbucket.org/yt_analysis/yt/issues/1258/potential-unit-error-in-cosmologypy), wherein the distance calculation was using the wrong unit system.  The meat of the fix is not conversion to \"Mpccm/h\", but using `self.cosmology.quan` to override the unit system to use the cosmology calculator's unit system.\n\nYou can see this by changing the above line in the yt tip to the following:\n\n```\n#!python\n\ntarget_distance = target_distance.to(\"Mpccm / h\")\n```\n\nand you will get the old behavior.",
                "html": "<p><a href=\"/chummels/\" rel=\"nofollow\" title=\"@chummels\" class=\"mention\">chummels</a>, yes, I believe the change is correct and the previous behavior was wrong.  That changeset, which added the following line:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">target_distance</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">cosmology</span><span class=\"o\">.</span><span class=\"n\">quan</span><span class=\"p\">(</span><span class=\"n\">target_distance</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"s2\">&quot;Mpccm / h&quot;</span><span class=\"p\">))</span>\n</pre></div>\n\n\n<p>was fixing the bug reported in <a href=\"https://bitbucket.org/yt_analysis/yt/issues/1258/potential-unit-error-in-cosmologypy\">Issue #1258</a>, wherein the distance calculation was using the wrong unit system.  The meat of the fix is not conversion to \"Mpccm/h\", but using <code>self.cosmology.quan</code> to override the unit system to use the cosmology calculator's unit system.</p>\n<p>You can see this by changing the above line in the yt tip to the following:</p>\n<div class=\"codehilite language-python\"><pre><span></span><span class=\"n\">target_distance</span> <span class=\"o\">=</span> <span class=\"n\">target_distance</span><span class=\"o\">.</span><span class=\"n\">to</span><span class=\"p\">(</span><span class=\"s2\">&quot;Mpccm / h&quot;</span><span class=\"p\">)</span>\n</pre></div>\n\n\n<p>and you will get the old behavior.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-10-21T22:51:59.691177+00:00",
            "updated_on": "2016-10-21T22:51:59.696710+00:00",
            "id": 25592727
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/chummels"
                    },
                    "html": {
                        "href": "https://bitbucket.org/chummels/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/chummels/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "chummels",
                "uuid": "{de871bb8-32e9-450a-b8c9-2b49a1334f16}",
                "username": "chummels"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25594744"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25594744"
                }
            },
            "parent": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25592727"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25592727"
                    }
                },
                "id": 25592727
            },
            "pullrequest": {
                "title": "Backport bugfixes for 3.3.2",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
                    }
                },
                "id": 2375
            },
            "content": {
                "raw": "OK, this makes sense.  Then I think this PR is good to go with Trident.",
                "html": "<p>OK, this makes sense.  Then I think this PR is good to go with Trident.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-10-22T02:27:27.801512+00:00",
            "updated_on": "2016-10-22T02:27:27.806046+00:00",
            "id": 25594744
        },
        {
            "user": {
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/users/ngoldbaum"
                    },
                    "html": {
                        "href": "https://bitbucket.org/ngoldbaum/"
                    },
                    "avatar": {
                        "href": "https://bitbucket.org/account/ngoldbaum/avatar/32/"
                    }
                },
                "type": "user",
                "display_name": "Nathan Goldbaum",
                "uuid": "{5dcd72da-6420-4a6d-9571-e75dffcac587}",
                "username": "ngoldbaum"
            },
            "type": "pullrequest_comment",
            "links": {
                "self": {
                    "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375/comments/25594765"
                },
                "html": {
                    "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375/_/diff#comment-25594765"
                }
            },
            "pullrequest": {
                "title": "Backport bugfixes for 3.3.2",
                "type": "pullrequest",
                "links": {
                    "self": {
                        "href": "https://api.bitbucket.org/2.0/repositories/yt_analysis/yt/pullrequests/2375"
                    },
                    "html": {
                        "href": "https://bitbucket.org/yt_analysis/yt/pull-requests/2375"
                    }
                },
                "id": 2375
            },
            "content": {
                "raw": "Ok, I'm going to backport a few more things, merge this, then make a source distribution.",
                "html": "<p>Ok, I'm going to backport a few more things, merge this, then make a source distribution.</p>",
                "markup": "markdown"
            },
            "created_on": "2016-10-22T02:38:23.731256+00:00",
            "updated_on": "2016-10-22T02:38:23.736105+00:00",
            "id": 25594765
        }
    ]
}